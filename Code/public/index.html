<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisation</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
        integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"
        integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H"
        crossorigin="anonymous"></script>
    <script src="app.js"></script>
    <link rel="icon" type="image/x-icon" href="/img/beer.svg">
    <style>
        .parent {
            position: relative;
            top: 0;
            left: 40%;
        }

        .image {
            position: relative;
            top: 0;
            left: 0;
        }

        .image2 {
            position: absolute;
            top: 0;
            left: 0;
            clip-path: polygon(100% 50%,
                    100% 100%,
                    0% 100%,
                    0% 50%);
        }
    </style>

</head>
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
<script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function () {
        OneSignal.init({
            appId: "b86bb1c7-a686-4471-a3a7-07bf311b13db",
            safari_web_id: "web.onesignal.auto.201c9c11-2835-4563-82b9-55a6f9094e87",
            notifyButton: {
                enable: true,
            },
            allowLocalhostAsSecureOrigin: true,
            // Your other init options here
            promptOptions: {
                slidedown: {
                    prompts: [
                        {
                            type: "push", // current types are "push" & "category"
                            autoPrompt: false,
                            text: {
                                /* limited to 90 characters */
                                actionMessage: "We'd like to show you notifications for the latest news and updates.",
                                /* acceptButton limited to 15 characters */
                                acceptButton: "Allow",
                                /* cancelButton limited to 15 characters */
                                cancelButton: "Cancel"
                            },
                            delay: {
                                pageViews: 1,
                                timeDelay: 20
                            }
                        }
                    ]
                }
            }
        });
    });
    OneSignal.push(function () {
        OneSignal.showSlidedownPrompt();
    });
</script>

<body>
    <nav class="navbar bg-warning">
        <ul class="bg-transparent text-center">
            <li><a href="https://github.com/GalateeM/SAE-ALT-S3-Dev-22-23-STDS-3B-Equipe-5" target="_blank"><i
                        class="fab fa-github"></i></a></li>
            <li class="fw-bold">PintVision</li>
            <li><a href="/index.html">Accueil</a></li>
            <li><a href="/maintenance.html">Maintenance</a></li>
        </ul>
    </nav>

    <table class="table table-bordered">
        <tbody>
            <tr>
                <td class="col-3" rowspan="2">
                    <btn class="card mb-4" onclick="cacherTout('cardJauge')" style="cursor:pointer;">
                        <div class="card-header bg-transparent">
                            Température
                        </div>
                        <div class="card-body bg-dark bg-opacity-10 text-center">
                            Intérieur : <span id="tint">~</span>°C
                            <br>
                            Extérieur : <span id="text">~</span>°C
                        </div>
                    </btn>
                    <div class="card mb-4" onclick="cacherTout('cardQuantite')" style="cursor:pointer;">
                        <div class="card-header bg-transparent">
                            Quantité fût
                        </div>
                        <div class="card-body bg-dark bg-opacity-10 text-center">
                            <span id="quantite">~</span> %
                        </div>
                    </div>
                    <div class="card mb-4" onclick="cacherTout('cardPuissance')" style="cursor:pointer;">
                        <div class="card-header bg-transparent">
                            Puissance
                        </div>
                        <div class="card-body bg-dark bg-opacity-10 text-center">
                            <span id="puissance">~</span> W
                        </div>
                    </div>
                    <div class="card mb-4" onclick="cacherTout('cardCo2')" style="cursor:pointer;">
                        <div class="card-header bg-transparent">
                            CO2
                        </div>
                        <div class="card-body bg-dark bg-opacity-10 text-center">
                            <span id="co2">~</span> g
                        </div>
                    </div>
                </td>
                <td class="col-4 p-4" colspan="3">

                    <h1 class="text-center" id="titre"></h1>
                    <div class="card">
                        <div class="card-body bg-dark pb-5" style="max-height:75%">
                            <canvas id="PuissanceHistorique"></canvas>
                        </div>
                    </div>
                </td>

            <tr>
                <td class="col-5">
                    <table class="table table-border">
                        <td>
                            <h3>ÉTAT</h3>
                        </td>
                        <td>
                            <span id="diag">Pas d'annonce en cours</span>
                        </td>
                    </table>

                    <h3 class="text-center">Informations supplémentaires</h3>

                    <div class="card" id="cardJauge">
                        <div class="card-body bg-dark bg-opacity-10">
                            <table class="table">
                                <td>
                                    <canvas id="jaugeInt"></canvas>
                                    Intérieur : <span id="tint2">~</span>°C
                                </td>
                                <td>
                                    <canvas id="jaugeExt"></canvas>
                                    Extérieur : <span id="text2">~</span>°C
                                </td>
                            </table>
                        </div>
                    </div>

                    <div class="card" id="cardQuantite">
                        <div class="card-body bg-dark bg-opacity-10">
                            <table class="table table-borderless text-center">
                                <tr>
                                    <td class="col-6">
                                        Quantité en pourcentage
                                    </td>
                                    <td>
                                        Quantité en bières
                                    </td>
                                </tr>
                                <tr>
                                    <td><img src="img/beer.svg" width="30%"></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td><span id="quantite2">~</span>%</td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="card" id="cardPuissance">
                        <div class="card-body bg-dark bg-opacity-10">
                            <div class="parent">
                                <img class="image" src="img/lightning.png" width="20%">
                                <img class="image2" id="image" src="img/lightning-y.png" width="20%">
                            </div>
                            <div class="text-center"><span id="puissance2" class="text-center">~</span>W</div>
                        </div>
                    </div>

                    <div class="card" id="cardCo2">
                        <div class="card-body bg-dark bg-opacity-10 h1 text-center">
                            <img src="img/earth.png" width="30%">
                            <span id="co22">~</span>g
                        </div>
                    </div>
                </td>

                <td class="col-6">
                    <div class="card mt-2 mb-3">
                        <div class="card-header">
                            <h3>Pannes en cours</h3>
                        </div>
                        <div class="card-body" id="histo">

                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>



    </td>
    </tbody>
    </table>
</body>

<script src="https://bernii.github.io/gauge.js/dist/gauge.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    this.document.getElementById("cardCo2").style.display = "none";
    this.document.getElementById("cardPuissance").style.display = "none";
    this.document.getElementById("cardQuantite").style.display = "none";
    this.document.getElementById("titre").textContent = "Température";
    var opts = {
        angle: 0.15, // The span of the gauge arc
        lineWidth: 0.44, // The line thickness
        radiusScale: 1, // Relative radius
        pointer: {
            length: 0.6, // // Relative to gauge radius
            strokeWidth: 0.035, // The thickness
            color: '#000000' // Fill color
        },
        limitMax: false,     // If false, max value increases automatically if value > maxValue
        limitMin: false,     // If true, the min value of the gauge will be fixed
        colorStart: '#6FADCF',   // Colors
        colorStop: '#8FC0DA',    // just experiment with them
        strokeColor: '#E0E0E0',  // to see which ones work best for you
        generateGradient: true,
        highDpiSupport: true,     // High resolution support

    };
    var targetInt = document.getElementById('jaugeInt'); // your canvas element
    var gaugeInt = new Gauge(targetInt).setOptions(opts); // create sexy gauge!
    gaugeInt.maxValue = 40; // set max gauge value
    gaugeInt.setMinValue(0);  // Prefer setter over gauge.minValue = 0
    gaugeInt.animationSpeed = 32; // set animation speed (32 is default value)


</script>
<script>
    var opts = {
        angle: 0.15, // The span of the gauge arc
        lineWidth: 0.44, // The line thickness
        radiusScale: 1, // Relative radius
        pointer: {
            length: 0.6, // // Relative to gauge radius
            strokeWidth: 0.035, // The thickness
            color: '#000000' // Fill color
        },
        limitMax: false,     // If false, max value increases automatically if value > maxValue
        limitMin: false,     // If true, the min value of the gauge will be fixed
        colorStart: '#6FADCF',   // Colors
        colorStop: '#8FC0DA',    // just experiment with them
        strokeColor: '#E0E0E0',  // to see which ones work best for you
        generateGradient: true,
        highDpiSupport: true,     // High resolution support

    };
    var targetExt = document.getElementById('jaugeExt'); // your canvas element
    var gaugeExt = new Gauge(targetExt).setOptions(opts); // create sexy gauge!
    gaugeExt.maxValue = 40; // set max gauge value
    gaugeExt.setMinValue(0);  // Prefer setter over gauge.minValue = 0
    gaugeExt.animationSpeed = 32; // set animation speed (32 is default value)


    function cacherTout(nom) {
        this.document.getElementById("cardCo2").style.display = "none";
        this.document.getElementById("cardPuissance").style.display = "none";
        this.document.getElementById("cardQuantite").style.display = "none";
        this.document.getElementById("cardJauge").style.display = "none";

        titre = "";

        switch (nom) {
            case "cardCo2":
                titre = "CO2"
                break;
            case "cardPuissance":
                titre = "Consommation"
                break;
            case "cardQuantite":
                titre = "Quantité restante"
                break;
            case "cardJauge":
                titre = "Température"
                break
        }
        document.getElementById("titre").textContent = titre;

        this.document.getElementById(nom).style.display = "block";
    }
</script>

<script>
    // Diagramme pour l'historique de la puissance
    socket.on("PuissanceHistorique", (arg) => {
        new Chart(
            document.getElementById('PuissanceHistorique'),
            {
                type: 'line',
                data: {
                    labels: arg.map(row => row.dateInsertion),
                    datasets: [
                        {
                            label: 'Historique de la puissance',
                            data: arg.map(row => row.data),
                            borderWidth: 1,
                            pointRadius: 0
                        }
                    ]
                }
            }
        );
    });
</script>

</html>